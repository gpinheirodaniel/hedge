Sub importar_dados_derivativos()
'
'importar_dados_derivativos Macro
'
Dim stNome As String, stPasta As String, stArquivo As String

stPasta = Path & "C:\Daniel\03-Mestrado UFF\DISSERTAÇÃO\Dados quantitativos\Series para dissertação\Arquivos\"
stNome = "1701.txt"
stArquivo = stPasta & stNome

'Abrir o arquivo organizado por colunas
    Workbooks.OpenText Filename:=stArquivo, Origin:=xlMSDOS, StartRow:=1, DataType:=xlFixedWidth, FieldInfo:= _
    Array(Array(0, 1), Array(11, 1), Array(19, 1), Array(21, 1), Array(24, 1), _
    Array(25, 1), Array(26, 1), Array(30, 1), Array(36, 1), Array(44, 1), Array(57, 1), _
    Array(70, 1), Array(83, 1), Array(96, 1), Array(104, 1), Array(222, 1), Array(230, 1)), TrailingMinusNumbers:=True
        

   
'Preciso abrir vários arquivos e nomear eles com uma variavel e assim fazer um loop na instrução abaixo
        


'Criar primeira coluna
    Rows("1:1").Insert Shift:=xlDown, CopyOrigin:=xlFormatFromLeftOrAbove
 
'Excluir colunas que não serão usadas OBS A coluna posterior se move para esquerda
    Columns("A").Delete
    Columns("N").Delete
    Columns("O").Delete
    
'Organizar cabeçalho
    Range("A1").Select
    ActiveCell.FormulaR1C1 = "Data da geração do arquivo"
    Range("B1").Select
    ActiveCell.FormulaR1C1 = "Tipo de negociação"
    Range("C1").Select
    ActiveCell.FormulaR1C1 = "Código da mercadoria"
    Range("D1").Select
    ActiveCell.FormulaR1C1 = "Código do mercado"
    Range("E1").Select
    ActiveCell.FormulaR1C1 = "Tipo da série"
    Range("F1").Select
    ActiveCell.FormulaR1C1 = "Série (opc)/ Vencimento(fut)"
    Range("G1").Select
    ActiveCell.FormulaR1C1 = "Hora da criação deste registro"
    Range("H1").Select
    ActiveCell.FormulaR1C1 = "Data de vencimento (fut/opç)"
    Range("I1").Select
    ActiveCell.FormulaR1C1 = "Preço de exercício (opç)"
    Range("J1").Select
    ActiveCell.FormulaR1C1 = "Valor do ponto ou tamanho do contrato"
    Range("K1").Select
    ActiveCell.FormulaR1C1 = "Volume do dia em R$"
    Range("L1").Select
    ActiveCell.FormulaR1C1 = "Volume do dia em U$"
    Range("M1").Select
    ActiveCell.FormulaR1C1 = "Qtde. de contratos em aberto"
    Range("N1").Select
    ActiveCell.FormulaR1C1 = "Cotação de fechamento do dia"

    
    
'Filtrar linhas importantes
    Columns("A:N").AutoFilter
    Columns("C").AutoFilter Field:=3, Criteria1:=Array( _
    "DOL"), Operator:=xlFilterValues

 
      
'Passar dados para planilha mãe e organizar
    Cells.Select
    Selection.Copy
    
    Windows("Dados derivativos.xlsm").Activate
    ActiveWorkbook.Sheets.Add After:=Worksheets(Worksheets.Count)
    ActiveSheet.Paste
    Application.CutCopyMode = False
    ActiveSheet.Name = stNome
    Columns("A:N").EntireColumn.AutoFit
    Columns("A:N").AutoFilter
    Columns("A:N").Select
    Selection.HorizontalAlignment = xlCenter
    
 
'Fechar arquivo de importação
    Windows(stNome).Activate
    ActiveWindow.Close savechanges:=False

End Sub
